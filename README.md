# MoodPing FastAPI ë°±ì—”ë“œ (DDD ì•„í‚¤í…ì²˜)

ê°ì • ê¸°ë¡ + AI ë¶„ì„ ì›¹ì•± ë°±ì—”ë“œ (FastAPI / Python 3.14 í˜¸í™˜)

ê¸°ì¡´ ìŠ¤íŒŒê²Œí‹° êµ¬ì¡°ì˜ ë°±ì—”ë“œë¥¼ **ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(DDD)**ì™€ **ë ˆì´ì–´ë“œ ì•„í‚¤í…ì²˜**ë¥¼ ì ìš©í•˜ì—¬ ì™„ì „íˆ ë¶„ë¦¬ëœ êµ¬ì¡°ë¡œ ì¬êµ¬ì„±í•œ ë…ë¦½ ì‹¤í–‰í˜• í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 0. ì´ìƒì ì¸ í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°
ì´ í”„ë¡œì íŠ¸ë¥¼ ë‹¤ë¥¸ ê³³ìœ¼ë¡œ ì´ë™í•˜ì—¬ ì‹¤í–‰í•  ë•Œ, `ModuleNotFoundError`ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ í´ë” ë°°ì¹˜ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤. (ì¸í”„ë¼ ì„¤ì • íŒŒì¼ë“¤ì€ ë°”ê¹¥ì—, íŒŒì´ì¬ ì½”ë“œëŠ” `moodping/` ì•ˆì— ë°°ì¹˜)

```text
MoodPing_Project/
â”œâ”€â”€ docker-compose.yml       # DB ì»¨í…Œì´ë„ˆ ì„¤ì •
â”œâ”€â”€ schema.sql               # DB ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ requirements.txt         # íŒŒì´ì¬ íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
â”œâ”€â”€ .env.example             # ë³µì‚¬í•´ì„œ .env ë¡œ ì‚¬ìš©
â””â”€â”€ moodping/                # ì‹¤ì œ íŒŒì´ì¬ ì†ŒìŠ¤ ì½”ë“œ í´ë”
    â”œâ”€â”€ main.py
    â”œâ”€â”€ config/
    â”œâ”€â”€ static/
    â””â”€â”€ ... (ë„ë©”ì¸ í´ë”ë“¤)
```

### 1. í™˜ê²½ë³€ìˆ˜ ì„¤ì •

```bash
cp .env.example .env
# .env íŒŒì¼ì„ ì—´ì–´ API í‚¤ ì…ë ¥ (ì¹´ì¹´ì˜¤, OpenAI ë“±)
```

### 2. Dockerë¡œ MySQL ì‹¤í–‰

```bash
docker compose up -d
# 3307 í¬íŠ¸ë¡œ MySQL ì„œë²„ ì‹¤í–‰ ë° schema.sql ìë™ ì ìš©
```

### 3. Python ê°€ìƒí™˜ê²½ & ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# ê°€ìƒí™˜ê²½ ìƒì„± (íŒŒì´ì¬ 3.14 ì™„ë²½ í˜¸í™˜)
python -m venv venv

# Windows
venv\Scripts\activate

# Mac/Linux
source venv/bin/activate

# ì˜ì¡´ì„± ì„¤ì¹˜ (ë²„ì „ ì¶©ëŒì„ ë§‰ê¸° ìœ„í•´ í•­ìƒ ì´ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”)
pip install -r requirements.txt
```

### 4. ì„œë²„ ì‹¤í–‰

**ë£¨íŠ¸ í´ë”(`MoodPing_Project/` ìœ„ì¹˜)**ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
uvicorn moodping.main:app --reload --port 33333
```

- ì›¹ì•± ì ‘ì†: `http://localhost:33333`
- API ë¬¸ì„œ: `http://localhost:33333/docs`

---

## ğŸ¤– LLM ì „í™˜ ë°©ë²•

`.env` íŒŒì¼ì˜ `LLM_PROVIDER` ê°’ë§Œ ë³€ê²½í•˜ë©´ ì—¬ëŸ¬ AI ëª¨ë¸ì„ ììœ ë¡­ê²Œ ìŠ¤ìœ„ì¹­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë¹„ì¦ˆë‹ˆìŠ¤ ì„œë¹„ìŠ¤ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”)

```bash
LLM_PROVIDER=openai   # GPT-4.1-mini (ê¸°ë³¸ê°’)
LLM_PROVIDER=gemini   # Gemini 2.5 Flash
LLM_PROVIDER=claude   # Claude Haiku 4.5
```

---

## ğŸ›ï¸ íŒ¨í‚¤ì§€ êµ¬ì¡° (ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„)

ê° ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°ëŠ¥ë³„ë¡œ í´ë”(ë„ë©”ì¸)ë¥¼ ë¶„ë¦¬í•˜ê³ , ë‚´ë¶€ë¥¼ ë‹¨ë°©í–¥ ê³„ì¸µí˜•(`Controller` -> `Service` -> `Repository`)ìœ¼ë¡œ ì—„ê²©í•˜ê²Œ ê´€ë¦¬í•©ë‹ˆë‹¤.

```text
moodping/
â”œâ”€â”€ main.py              # ì•± ì§„ì…ì  (FastAPI)
â”œâ”€â”€ config/              # ê³µí†µ í™˜ê²½ ë° DB ì„¤ì •
â”œâ”€â”€ static/              # í”„ë¡ íŠ¸ì—”ë“œ ì •ì  íŒŒì¼
â”œâ”€â”€ llm/                 # í†µí•© LLM í´ë¼ì´ì–¸íŠ¸ ëª¨ë“ˆ (Factory íŒ¨í„´)
â”‚
â”œâ”€â”€ account/             # ë„ë©”ì¸: ì‚¬ìš©ì ê³„ì •
â”œâ”€â”€ authentication/      # ë„ë©”ì¸: JWT ì„¸ì…˜
â”œâ”€â”€ kakao_authentication/# ë„ë©”ì¸: ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í”Œë¡œìš°
â”œâ”€â”€ mood_record/         # ë„ë©”ì¸: ê°ì • ê¸°ë¡
â”œâ”€â”€ mood_analysis/       # ë„ë©”ì¸: LLM ê°ì • ë¶„ì„
â”œâ”€â”€ weekly_report/       # ë„ë©”ì¸: ì£¼ê°„ ë¦¬í¬íŠ¸
â””â”€â”€ event_log/           # ë„ë©”ì¸: í¼ë„/ë¦¬í…ì…˜ ë¶„ì„ ë¡œê·¸

[ë„ë©”ì¸ ë‚´ë¶€ ê¸°ë³¸ êµ¬ì¡°]
â””â”€â”€ {ë„ë©”ì¸ëª…}/
    â”œâ”€â”€ controller/       # FastAPI ë¼ìš°í„° ë° ìš”ì²­ DTO
    â”œâ”€â”€ service/          # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ì¸í„°í˜ì´ìŠ¤ & ì‹±ê¸€í†¤ êµ¬í˜„ì²´)
    â”œâ”€â”€ repository/       # DB ë° ì™¸ë¶€ API ì—°ë™
    â””â”€â”€ domain/entity/    # SQLAlchemy ëª¨ë¸ (Factory Method 'create' íŒ¨í„´ ì‚¬ìš©)
```

---

## ğŸ”Œ ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸

| ë©”ì„œë“œ | URL | ë‹´ë‹¹ ë„ë©”ì¸ | ì„¤ëª… |
|--------|-----|-------------|------|
| `GET`  | `/auth/kakao` | `kakao_authentication` | ì¹´ì¹´ì˜¤ OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| `GET`  | `/auth/callback` | `kakao_authentication` | ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ + Account ìƒì„± + JWT ë°œê¸‰ |
| `GET`  | `/auth/me` | `authentication` | í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ (Bearer í† í° í•„ìš”) |
| `POST` | `/mood-records` | `mood_record` | ê°ì • ê¸°ë¡ ì €ì¥ + ì¦‰ì‹œ LLM ë¶„ì„ ì‹¤í–‰ |
| `GET`  | `/api/reports/weekly/latest` | `weekly_report` | ì£¼ê°„ ë¦¬í¬íŠ¸ ì¡°íšŒ/ìƒì„± (Bearer í† í° í•„ìš”) |
| `POST` | `/api/events` | `event_log` | í”„ë¡ íŠ¸ì—”ë“œ í¼ë„ ì´ë²¤íŠ¸ ë¡œê·¸ ì €ì¥ |
| `GET`  | `/api/debug/metrics` | `event_log` | í¼ë„ ì´íƒˆë¥  + 7ì¼ ë¦¬í…ì…˜ ì§€í‘œ (ë””ë²„ê·¸) |
| `POST` | `/users/link-data` | `account` | ë¹„ë¡œê·¸ì¸(anon_id) ë°ì´í„°ë¥¼ ë¡œê·¸ì¸(user_id)ìœ¼ë¡œ ìŠ¹ê³„ |
| `GET`  | `/docs` | `main.py` | Swagger UI ìë™ ìƒì„± |
